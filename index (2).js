(function(C,i,D,P,d,o,R){"use strict";function m(t,e,r,a,c,n,l){try{var s=t[n](l),g=s.value}catch(N){r(N);return}s.done?e(g):Promise.resolve(g).then(a,c)}function k(t){return function(){var e=this,r=arguments;return new Promise(function(a,c){var n=t.apply(e,r);function l(g){m(n,a,c,l,s,"next",g)}function s(g){m(n,a,c,l,s,"throw",g)}l(void 0)})}}var{FormSection:F,FormInput:b,FormDivider:f,FormRow:S}=D.Forms,_=d.findByStoreName("ChannelStore"),I=d.findByStoreName("SelectedChannelStore"),y=d.findByStoreName("MessageStore"),v=d.findByProps("dispatch","subscribe");function B(){return k(function*(){var t=o.storage.userId,e=o.storage.originalContent,r=o.storage.newContent;if(!t||!t.trim()){i.ReactNative.Alert.alert("Error","Please enter the sender's user ID.");return}if(!e||!e.trim()){i.ReactNative.Alert.alert("Error","Please enter the original message content to match.");return}if(!r||!r.trim()){i.ReactNative.Alert.alert("Error","Please enter the new message content.");return}var a=I?.getChannelId?.();if(!a){i.ReactNative.Alert.alert("Error","No channel selected. Open the DM you want to edit a message in.");return}var c=_.getChannel?.(a);if(!c||c.type!==1&&c.type!==3){i.ReactNative.Alert.alert("Error","This plugin only works in DMs or group DMs.");return}if(!y||!y.getMessages){i.ReactNative.Alert.alert("Error","MessageStore API not available on this build.");return}try{var n=y.getMessages(a),l=[];Array.isArray(n)?l=n:n?.toArray?l=n.toArray():Array.isArray(n?._array)?l=n._array:typeof n=="object"&&n!==null&&(l=Object.values(n));var s=[...l].reverse().find(u=>u?.author?.id===t&&typeof u?.content=="string"&&u.content===e);if(!s){i.ReactNative.Alert.alert("Error","Could not find a message in this DM from that user with the exact original content.");return}if(!v?.dispatch){i.ReactNative.Alert.alert("Error","Dispatcher not available on this build.");return}var g=o.storage.edits??{},N=g[s.id],T=N?.originalContent??(typeof s.content=="string"?s.content:e);g[s.id]={channelId:a,newContent:r,originalContent:T},o.storage.edits=g,v.dispatch({type:"MESSAGE_UPDATE",message:{...s,content:r,guild_id:_.getChannel(s.channel_id)?.guild_id},log_edit:!1,otherPluginBypass:!0}),i.ReactNative.Alert.alert("Success","Message content updated locally in this DM.")}catch(u){console.error("[FakeDMMessage] Error editing message:",u),i.ReactNative.Alert.alert("Error",`Failed to edit message: ${u?.message??"Unknown error"}`)}})()}function O(){var t=o.storage.edits??{},e=Object.keys(t);if(e.length===0){i.ReactNative.Alert.alert("Nothing to clear","There are no fake edits to undo.");return}if(!v?.dispatch){i.ReactNative.Alert.alert("Error","Dispatcher not available on this build.");return}try{for(var r of e){var a=t[r];if(a){var{channelId:c,originalContent:n}=a;if(!(!c||typeof n!="string")){var l=y?.getMessage?.(c,r);l&&v.dispatch({type:"MESSAGE_UPDATE",message:{...l,content:n,guild_id:_.getChannel(l.channel_id)?.guild_id},log_edit:!1,otherPluginBypass:!0})}}}o.storage.edits={},i.ReactNative.Alert.alert("Cleared","All fake edits have been undone.")}catch(s){console.error("[FakeDMMessage] Error clearing edits:",s),i.ReactNative.Alert.alert("Error",`Failed to clear edits: ${s?.message??"Unknown error"}`)}}function x(){P.useProxy(o.storage);var t=o.storage.userId??"",e=o.storage.originalContent??"",r=o.storage.newContent??"";return React.createElement(i.ReactNative.ScrollView,{style:{flex:1}},React.createElement(F,{title:"Fake Edit Message in this DM"},React.createElement(b,{title:"Sender User ID",value:t,onChange:a=>{o.storage.userId=a},placeholder:"Paste the user ID of who sent the message",keyboardType:"numeric"}),React.createElement(f,null),React.createElement(b,{title:"Original Message Content",value:e,onChange:a=>{o.storage.originalContent=a},placeholder:'Exact text they sent (e.g. "hey")',multiline:!0,numberOfLines:2}),React.createElement(f,null),React.createElement(b,{title:"New Message Content",value:r,onChange:a=>{o.storage.newContent=a},placeholder:'What you want it to look like (e.g. "goodbye")',multiline:!0,numberOfLines:3}),React.createElement(f,null),React.createElement(S,{label:"Apply Fake Edit",subLabel:"Find matching message from that user in this DM and change its text locally",onPress:B}),React.createElement(f,null),React.createElement(S,{label:"Clear All Fake Edits",subLabel:"Undo all local edits made by this plugin",onPress:O})))}var E=d.findByStoreName("MessageStore"),w=d.findByStoreName("ChannelStore"),A,M,p,U=()=>o.storage.edits??{},j=t=>{var e=U(),r=e[t];if(r)return typeof r=="string"?r:r.newContent},h=t=>{if(!(!t||typeof t.id!="string")){var e=j(t.id);e&&typeof t.content=="string"&&(t.content=e)}},L={onLoad:()=>{E?.getMessage&&!A&&(A=R.after("getMessage",E,([,t],e)=>{e&&h(e)})),E?.getMessages&&!M&&(M=R.after("getMessages",E,([t],e)=>{if(e)if(Array.isArray(e))e.forEach(h);else if(e.toArray&&typeof e.toArray=="function")try{e.toArray().forEach(h)}catch{}else Array.isArray(e._array)?e._array.forEach(h):typeof e=="object"&&Object.values(e).forEach(h)})),w?.getChannel&&!p&&(p=R.after("getChannel",w,([t],e)=>{if(e){var r=[];e.lastMessage&&r.push(e.lastMessage),e.last_message&&r.push(e.last_message),e.recentMessage&&r.push(e.recentMessage),r.forEach(h)}}))},onUnload:()=>{A&&A(),M&&M(),p&&p()},settings:x};return C.default=L,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.metro,vendetta.plugin,vendetta.patcher);
